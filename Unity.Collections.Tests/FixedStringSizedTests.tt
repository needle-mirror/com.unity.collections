<#/*THIS IS A T4 FILE - see t4_text_templating.md for what it is and how to run codegen*/#>
<#@ template debug="True" #>
<#@ output extension=".gen.cs" #>
<#@ assembly name="System.Core" #>

//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//
//     TextTransform Samples/Packages/com.unity.collections/Unity.Collections.Tests/FixedStringSizedTests.tt
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

#if !UNITY_DOTSRUNTIME
using System;
using NUnit.Framework;
using Unity.Collections;

namespace FixedStringTests
{

internal class FixedStringSizedTests
{
<#
var SIZES = new int[] {32,64,128,512,4096};
foreach(var BYTES in SIZES)
{
    // 2 bytes ushort + 1 byte space for null termination
    var ALMOST_TOO_BIG = new String('o', BYTES - 3);
    var TOO_BIG = new String('o', BYTES - 2);
#>
    [TestCase("<#=ALMOST_TOO_BIG#>", FormatError.None)]
    [TestCase("<#=TOO_BIG#>", FormatError.Overflow)]
    public void FixedString<#=BYTES#>AtMaximumSizeWorks(String a, FormatError expectedError)
    {
        FixedString<#=BYTES#> aa = default;
        aa.Junk();
        var error = aa.Append(a);
        Assert.AreEqual(expectedError, error);
        aa.AssertNullTerminated();
    }

    [Test]
    public unsafe void FixedString<#=BYTES#>ToFixedList()
    {
        FixedString<#=BYTES#> a = default;
        a.Junk();
        a.Append("0123");
        ref var aList = ref a.AsFixedList();
        Assert.IsFalse(aList.IsEmpty);
        Assert.AreEqual(4, aList.Length);
        Assert.AreEqual(a.Capacity + 1, aList.Capacity);
        Assert.AreEqual('0', aList[0]);
        Assert.AreEqual('1', aList[1]);
        Assert.AreEqual('2', aList[2]);
        Assert.AreEqual('3', aList[3]);
        aList.Add((byte)'4');
        Assert.AreEqual("01234", a);
        // because we modified it as a FixedList, it will not be null terminated!
        Assert.AreNotEqual(0, a.GetUnsafePtr()[a.Length]);
    }

<#
    foreach(var OTHERBYTES in SIZES)
    {
        if (OTHERBYTES != BYTES)
        {
#>

    [TestCase("red")]
    [TestCase("紅色", TestName="{m}(Chinese-Red)")]
    [TestCase("George Washington")]
    [TestCase("村上春樹", TestName="{m}(HarukiMurakami)")]
    public void FixedString<#=BYTES#>ToFixedString<#=OTHERBYTES#>Works(String a)
    {
        var b = new FixedString<#=BYTES#>(a);
        var c = new FixedString<#=OTHERBYTES#>(b);
        String d = c.ToString();
        Assert.AreEqual(a, d);
    }
<#
        }
    }
}
#>

}

}
#endif
